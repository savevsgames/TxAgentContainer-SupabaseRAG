{
  "info": {
    "name": "TxAgent Medical RAG API Tests - Updated",
    "description": "Comprehensive test collection for TxAgent Hybrid Container with centralized authentication and clean database schema",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://your-txagent-container-url.proxy.runpod.net",
      "type": "string",
      "description": "TxAgent container URL on RunPod"
    },
    {
      "key": "jwt_token",
      "value": "your_supabase_jwt_token_here",
      "type": "string",
      "description": "Valid Supabase JWT token with sub, aud, and role claims"
    },
    {
      "key": "job_id",
      "value": "",
      "type": "string",
      "description": "Embedding job ID from /embed endpoint"
    },
    {
      "key": "agent_id",
      "value": "",
      "type": "string",
      "description": "Agent session ID from /agents endpoint"
    }
  ],
  "item": [
    {
      "name": "1. Health Check",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has status field\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('status');",
              "    pm.expect(jsonData.status).to.eql('healthy');",
              "});",
              "",
              "pm.test(\"Response has model info\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('model');",
              "    pm.expect(jsonData).to.have.property('device');",
              "    pm.expect(jsonData).to.have.property('version');",
              "    console.log(`Model: ${jsonData.model}, Device: ${jsonData.device}, Version: ${jsonData.version}`);",
              "});",
              "",
              "console.log(\"‚úÖ Health check successful - TxAgent container is running with centralized auth\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/health",
          "host": ["{{base_url}}"],
          "path": ["health"]
        },
        "description": "Check if the TxAgent container is healthy and running"
      }
    },
    {
      "name": "2. Test GET Endpoint",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has message\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('message');",
              "    pm.expect(jsonData.message).to.include('GET endpoint working');",
              "});",
              "",
              "console.log(\"‚úÖ Test GET endpoint successful\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/test",
          "host": ["{{base_url}}"],
          "path": ["test"]
        },
        "description": "Test basic GET endpoint functionality"
      }
    },
    {
      "name": "3. Test POST Endpoint",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has message\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('message');",
              "    pm.expect(jsonData.message).to.include('POST endpoint working');",
              "});",
              "",
              "pm.test(\"Response echoes sent data\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('received_data');",
              "    pm.expect(jsonData.received_data.test).to.eql('centralized_auth');",
              "});",
              "",
              "console.log(\"‚úÖ Test POST endpoint successful\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"test\": \"centralized_auth\",\n  \"timestamp\": \"2025-01-08T00:00:00Z\",\n  \"user\": \"postman_test\",\n  \"architecture\": \"consolidated\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/test",
          "host": ["{{base_url}}"],
          "path": ["test"]
        },
        "description": "Test basic POST endpoint functionality"
      }
    },
    {
      "name": "4. Create Agent Session (Centralized Auth)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has agent ID\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('id');",
              "    pm.collectionVariables.set('agent_id', jsonData.id);",
              "    console.log(\"Agent ID: \" + jsonData.id);",
              "});",
              "",
              "pm.test(\"Response has correct status\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('status');",
              "    pm.expect(jsonData.status).to.be.oneOf(['initializing', 'active']);",
              "});",
              "",
              "pm.test(\"Response has user_id\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('user_id');",
              "    console.log(\"User ID: \" + jsonData.user_id);",
              "});",
              "",
              "console.log(\"‚úÖ Agent session created successfully using centralized auth service\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token with sub, aud, and role claims"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"session_data\": {\n    \"container_url\": \"{{base_url}}\",\n    \"capabilities\": [\"embedding\", \"chat\"],\n    \"model\": \"dmis-lab/biobert-v1.1\",\n    \"architecture\": \"centralized_auth\",\n    \"created_by\": \"postman_test\"\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/agents",
          "host": ["{{base_url}}"],
          "path": ["agents"]
        },
        "description": "Create a new agent session using centralized authentication service"
      }
    },
    {
      "name": "5. Get Active Agent (Centralized Auth)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has agent info\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('agent');",
              "    if (jsonData.agent) {",
              "        pm.expect(jsonData.agent).to.have.property('id');",
              "        pm.expect(jsonData.agent).to.have.property('status');",
              "        pm.expect(jsonData.agent).to.have.property('user_id');",
              "        console.log(\"Active agent found: \" + jsonData.agent.id);",
              "        console.log(\"Agent status: \" + jsonData.agent.status);",
              "    } else {",
              "        console.log(\"No active agent found\");",
              "    }",
              "});",
              "",
              "console.log(\"‚úÖ Get active agent successful using centralized auth\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token validated by centralized auth service"
          }
        ],
        "url": {
          "raw": "{{base_url}}/agents/active",
          "host": ["{{base_url}}"],
          "path": ["agents", "active"]
        },
        "description": "Get active agent session using centralized authentication"
      }
    },
    {
      "name": "6. Embed Medical Document (Clean Schema)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200 or 202\", function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 202]);",
              "});",
              "",
              "pm.test(\"Response has job_id\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('job_id');",
              "    pm.collectionVariables.set('job_id', jsonData.job_id);",
              "    console.log(\"Job ID: \" + jsonData.job_id);",
              "});",
              "",
              "pm.test(\"Response has status\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('status');",
              "    pm.expect(jsonData.status).to.be.oneOf(['pending', 'processing', 'completed']);",
              "});",
              "",
              "pm.test(\"Response has message\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('message');",
              "    console.log(\"Message: \" + jsonData.message);",
              "});",
              "",
              "console.log(\"‚úÖ Document embedding job created successfully with clean schema\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for RLS-compliant operations"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"file_path\": \"test-documents/morgellons-disease.md\",\n  \"metadata\": {\n    \"title\": \"Rare Medical Conditions: Morgellons Disease\",\n    \"author\": \"Dr. Sarah Johnson\",\n    \"category\": \"dermatology\",\n    \"year\": \"2024\",\n    \"source\": \"Medical Research Database\",\n    \"document_type\": \"research_paper\",\n    \"keywords\": [\"morgellons\", \"dermatology\", \"rare_disease\", \"fibers\"],\n    \"test_document\": true\n  }\n}"
        },
        "url": {
          "raw": "{{base_url}}/embed",
          "host": ["{{base_url}}"],
          "path": ["embed"]
        },
        "description": "Process and embed a medical document using the clean database schema"
      }
    },
    {
      "name": "7. Get Job Status (RLS Compliant)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200 or 404\", function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    pm.test(\"Response has job status\", function () {",
              "        var jsonData = pm.response.json();",
              "        pm.expect(jsonData).to.have.property('status');",
              "        pm.expect(jsonData).to.have.property('job_id');",
              "        console.log(\"Job status: \" + jsonData.status);",
              "        ",
              "        if (jsonData.status === 'completed') {",
              "            console.log(\"‚úÖ Document embedding completed successfully\");",
              "            console.log(\"Chunks created: \" + (jsonData.chunk_count || 'unknown'));",
              "            if (jsonData.document_ids && jsonData.document_ids.length > 0) {",
              "                console.log(\"Document IDs: \" + jsonData.document_ids.join(', '));",
              "            }",
              "        } else if (jsonData.status === 'processing') {",
              "            console.log(\"‚è≥ Document embedding is still processing\");",
              "        } else if (jsonData.status === 'failed') {",
              "            console.log(\"‚ùå Document embedding failed: \" + (jsonData.error || 'unknown error'));",
              "        } else if (jsonData.status === 'pending') {",
              "            console.log(\"‚è≥ Document embedding is pending\");",
              "        }",
              "    });",
              "} else {",
              "    console.log(\"‚ùå Job not found or access denied (RLS working correctly)\");",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for RLS-filtered access"
          }
        ],
        "url": {
          "raw": "{{base_url}}/embedding-jobs/{{job_id}}",
          "host": ["{{base_url}}"],
          "path": ["embedding-jobs", "{{job_id}}"]
        },
        "description": "Check embedding job status with RLS compliance"
      }
    },
    {
      "name": "8. Chat Query - Morgellons Symptoms (Vector Search)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has answer\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('response');",
              "    pm.expect(jsonData).to.have.property('status');",
              "    console.log(\"Response preview: \" + jsonData.response.substring(0, 150) + \"...\");",
              "});",
              "",
              "pm.test(\"Response has sources array\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('sources');",
              "    pm.expect(jsonData.sources).to.be.an('array');",
              "    ",
              "    if (jsonData.sources.length > 0) {",
              "        console.log(\"Sources found: \" + jsonData.sources.length);",
              "        console.log(\"Top similarity score: \" + jsonData.sources[0].similarity);",
              "        ",
              "        // Test that sources have required fields",
              "        pm.expect(jsonData.sources[0]).to.have.property('content');",
              "        pm.expect(jsonData.sources[0]).to.have.property('metadata');",
              "        pm.expect(jsonData.sources[0]).to.have.property('similarity');",
              "    } else {",
              "        console.log(\"No sources found - may need to wait for embedding to complete\");",
              "    }",
              "});",
              "",
              "console.log(\"‚úÖ Chat query successful using standardized match_documents function\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for RLS-filtered vector search"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"What are the main symptoms of Morgellons disease?\",\n  \"history\": [],\n  \"top_k\": 5,\n  \"temperature\": 0.7,\n  \"stream\": false\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        },
        "description": "Query about Morgellons symptoms using the standardized vector search function"
      }
    },
    {
      "name": "9. Chat Query - Treatment Options (BioBERT)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has answer\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('response');",
              "    pm.expect(jsonData).to.have.property('status');",
              "    console.log(\"Response preview: \" + jsonData.response.substring(0, 150) + \"...\");",
              "});",
              "",
              "pm.test(\"Vector search working\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('sources');",
              "    ",
              "    if (jsonData.sources.length > 0) {",
              "        console.log(\"BioBERT embeddings found \" + jsonData.sources.length + \" relevant chunks\");",
              "        ",
              "        // Check that similarity scores are reasonable",
              "        jsonData.sources.forEach((source, index) => {",
              "            console.log(`Source ${index + 1} similarity: ${source.similarity}`);",
              "            pm.expect(source.similarity).to.be.at.least(0);",
              "            pm.expect(source.similarity).to.be.at.most(1);",
              "        });",
              "    } else {",
              "        console.log(\"No relevant sources found for treatment query\");",
              "    }",
              "});",
              "",
              "console.log(\"‚úÖ Treatment query successful using BioBERT embeddings\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for authenticated vector search"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"What treatment approaches are available for Morgellons disease?\",\n  \"history\": [],\n  \"top_k\": 5,\n  \"temperature\": 0.7,\n  \"stream\": false\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        },
        "description": "Query about treatment options using BioBERT medical embeddings"
      }
    },
    {
      "name": "10. Chat Query - Research Controversy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response handles complex medical topic\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('response');",
              "    pm.expect(jsonData).to.have.property('status');",
              "    ",
              "    // Check that response is substantial for complex query",
              "    pm.expect(jsonData.response.length).to.be.at.least(50);",
              "    console.log(\"Response length: \" + jsonData.response.length + \" characters\");",
              "});",
              "",
              "pm.test(\"Sources provide context\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('sources');",
              "    ",
              "    if (jsonData.sources.length > 0) {",
              "        console.log(\"Found \" + jsonData.sources.length + \" contextual sources\");",
              "        ",
              "        // Check metadata structure",
              "        if (jsonData.sources[0].metadata) {",
              "            console.log(\"Metadata keys: \" + Object.keys(jsonData.sources[0].metadata).join(', '));",
              "        }",
              "    }",
              "});",
              "",
              "console.log(\"‚úÖ Complex research query handled successfully\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for authenticated operations"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"Why is Morgellons disease controversial in the medical community?\",\n  \"history\": [],\n  \"top_k\": 5,\n  \"temperature\": 0.7,\n  \"stream\": false\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        },
        "description": "Query about medical controversy using contextual understanding"
      }
    },
    {
      "name": "11. Chat Query - No Results Test",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"System handles irrelevant queries gracefully\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('response');",
              "    pm.expect(jsonData).to.have.property('status');",
              "    ",
              "    if (jsonData.status === 'no_results') {",
              "        console.log(\"‚úÖ System correctly indicated no relevant results\");",
              "        pm.expect(jsonData.response).to.include(\"couldn't find\");",
              "    } else {",
              "        console.log(\"System attempted to answer with available context\");",
              "        // Should have very few or no sources for irrelevant query",
              "        pm.expect(jsonData.sources.length).to.be.at.most(2);",
              "    }",
              "});",
              "",
              "console.log(\"‚úÖ No results handling test completed\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for authenticated operations"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"What is the weather forecast for Mars next week?\",\n  \"history\": [],\n  \"top_k\": 3,\n  \"temperature\": 0.5\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        },
        "description": "Test system behavior with completely irrelevant query"
      }
    },
    {
      "name": "12. Terminate Agent Session (Clean Cleanup)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200 or 404\", function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    pm.test(\"Response has success message\", function () {",
              "        var jsonData = pm.response.json();",
              "        pm.expect(jsonData).to.have.property('message');",
              "        console.log(\"‚úÖ Agent session terminated successfully\");",
              "        console.log(\"Message: \" + jsonData.message);",
              "    });",
              "} else {",
              "    console.log(\"‚ùå Agent session not found or already terminated (RLS working)\");",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "JWT token for authenticated deletion"
          }
        ],
        "url": {
          "raw": "{{base_url}}/agents/{{agent_id}}",
          "host": ["{{base_url}}"],
          "path": ["agents", "{{agent_id}}"]
        },
        "description": "Terminate agent session with proper cleanup"
      }
    },
    {
      "name": "13. Test Authentication Failure",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 401\", function () {",
              "    pm.response.to.have.status(401);",
              "});",
              "",
              "pm.test(\"Response has error message\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('detail');",
              "    console.log(\"Error message: \" + jsonData.detail);",
              "    ",
              "    // Should be a meaningful auth error",
              "    pm.expect(jsonData.detail).to.be.oneOf([",
              "        'Invalid token signature',",
              "        'Token has expired',",
              "        'Invalid token format',",
              "        'Invalid token audience',",
              "        'Authorization header missing'",
              "    ]);",
              "});",
              "",
              "console.log(\"‚úÖ Authentication failure test successful - centralized auth working\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer invalid_token_for_testing",
            "description": "Invalid token to test auth failure"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"This should fail due to invalid token\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        },
        "description": "Test centralized authentication failure handling"
      }
    },
    {
      "name": "14. Test RLS Isolation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 401 or 403\", function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([401, 403, 404]);",
              "});",
              "",
              "pm.test(\"RLS prevents access to other user data\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('detail');",
              "    console.log(\"RLS protection message: \" + jsonData.detail);",
              "});",
              "",
              "console.log(\"‚úÖ RLS isolation test successful - user data properly protected\");"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "description": "Valid token but trying to access non-existent job"
          }
        ],
        "url": {
          "raw": "{{base_url}}/embedding-jobs/00000000-0000-0000-0000-000000000000",
          "host": ["{{base_url}}"],
          "path": ["embedding-jobs", "00000000-0000-0000-0000-000000000000"]
        },
        "description": "Test that RLS prevents access to non-existent or other user's data"
      }
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Pre-request script for the entire collection",
          "console.log('üöÄ Starting TxAgent API Tests with Centralized Authentication');",
          "console.log('üìã Testing Features:');",
          "console.log('   - Centralized authentication service');",
          "console.log('   - Clean database schema (single migration)');",
          "console.log('   - RLS-compliant operations');",
          "console.log('   - BioBERT embeddings (768-dimensional)');",
          "console.log('   - Standardized match_documents function');",
          "console.log('   - User data isolation');",
          "",
          "// Validate that required variables are set",
          "if (!pm.collectionVariables.get('base_url') || pm.collectionVariables.get('base_url') === 'https://your-txagent-container-url.proxy.runpod.net') {",
          "    console.warn('‚ö†Ô∏è Please update the base_url collection variable with your actual TxAgent container URL');",
          "}",
          "",
          "if (!pm.collectionVariables.get('jwt_token') || pm.collectionVariables.get('jwt_token') === 'your_supabase_jwt_token_here') {",
          "    console.warn('‚ö†Ô∏è Please update the jwt_token collection variable with a valid Supabase JWT token');",
          "    console.warn('   Token must have: sub (user_id), aud: \"authenticated\", role: \"authenticated\"');",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Post-response script for the entire collection",
          "// This runs after each request in the collection"
        ]
      }
    }
  ]
}